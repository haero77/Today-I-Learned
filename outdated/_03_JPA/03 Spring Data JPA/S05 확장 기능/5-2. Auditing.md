# 5-2. Auditing

- ê¸°ë³¸ìœ¼ë¡œ í…Œì´ë¸” ë§Œë“¤ ë•Œ `ë“±ë¡ì¼`ê³¼ `ìˆ˜ì •ì¼` ë‚¨ê¸´ë‹¤.
  - ë°ì´í„°ë¥¼ ì¶”ì í•˜ê¸° ìœ„í•´ì„œ ì‚¬ìš©. ì—†ìœ¼ë©´ ì§€ì˜¥ì„ ë§›ë³¸ë‹¤...ğŸ¤£

- ì—”í‹°í‹°ë¥¼ ìƒì„±, ë³€ê²½í•  ë•Œ ë³€ê²½í•œ ì‚¬ëŒê³¼ ì‹œê°„ì„ ì¶”ì í•˜ê³  ì‹¶ìœ¼ë©´?
  - ë“±ë¡ì¼
  - ìˆ˜ì •ì¼
  - ë“±ë¡ì
  - ìˆ˜ì •ì

- ì‹¤ë¬´ì—ì„œ ë§ì´ ì‚¬ìš©í•œë‹¤.

<br>

## ìˆœìˆ˜ JPAë¥¼ ì‚¬ìš©í•œ Auditing

```java
@Getter
@MappedSuperclass
public class JpaBaseEntity {

	@Column(updatable = false)
	private LocalDateTime createdDate;

	private LocalDateTime updatedDate;

	@PrePersist
	public void prePersist() {
		LocalDateTime now = LocalDateTime.now();
		createdDate = now;
		updatedDate = now;
	}

	@PreUpdate
	public void preUpdate() {
		updatedDate = LocalDateTime.now();
	}

}
```

```java
// JpaBaseEntity ë¥¼ ìƒì†
public class Member extends JpaBaseEntity{
    ...
}
```

- `@MappedSuperClass`
  - ì§„ì§œ JPA ìƒì†ê´€ê³„ê°€ ì•„ë‹Œ, ì»¬ëŸ¼ë§Œ ìƒì†í•  ë•Œ ì‚¬ìš©.


### JPA ì£¼ìš” ì´ë²¤íŠ¸ ì–´ë…¸í…Œì´ì…˜

- @PrePersist, @PostPersist
- @PreUpdate, @PostUpdate

<br>

## ìŠ¤í”„ë§ ë°ì´í„° JPAë¥¼ ì‚¬ìš©í•œ Auditing 

```java
@EntityListeners(AuditingEntityListener.class)
@MappedSuperclass
@Getter
public class BaseTimeEntity {

  @CreatedDate
  @Column(updatable = false)
  private LocalDateTime createdDate;

  @LastModifiedDate
  private LocalDateTime lastModifiedDate;

}
```

```java
@EntityListeners(AuditingEntityListener.class)
@MappedSuperclass
@Getter
public class BaseEntity extends BaseTimeEntity {

  @CreatedBy
  @Column(updatable = false)
  private String createdBy;

  @LastModifiedBy
  private String lastModifiedBy;

}
```

```java
@EnableJpaAuditing
@SpringBootApplication
public class DataJpaApplication {

    public static void main(String[] args) {
        SpringApplication.run(DataJpaApplication.class, args);
    }
    
    @Bean
    public AuditorAware<String> auditorProvider() {
      // @CreatedBy, @lastModifiedBy ê°€ ì´ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•´ì„œ ê°’ì„ êº¼ë‚´ê°„ë‹¤.
      // Security ë˜ëŠ” Session ë“±ì—ì„œ Idë¥¼ êº¼ë‚´ì„œ ì“°ë©´ ëœë‹¤.
        return () -> Optional.of(UUID.randomUUID().toString());
    }

}
```

- ëª¨ë“  í…Œì´ë¸”ì—ì„œ `ë“±ë¡ì¼`, `ìˆ˜ì •ì¼`ì´ í•„ìš”í•œ ë°˜ë©´, `ë“±ë¡ì`, `ìˆ˜ì •ì`ëŠ” í•„ìš”í•œ ê²½ìš°ì™€ ê·¸ë ‡ì§€ ì•Šì€ ê²½ìš°ê°€ ë¶„ëª…íˆ ë‚˜ë‰œë‹¤.
  - ë”°ë¼ì„œ, `BaseTimeEntity` ì™€ `BaseEntity` ë¥¼ ë¶„ë¦¬í•˜ê³  ì›í•˜ëŠ” íƒ€ì…ì„ ì„ íƒí•´ì„œ ìƒì†í•œë‹¤.
- `ë“±ë¡ì`, `ìˆ˜ì •ì`ê°€ í•„ìš”í•œ ê²½ìš°,
  - ì‹¤ë¬´ì—ì„œëŠ” ì„¸ì…˜ ì •ë³´ë‚˜, ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ë¡œê·¸ì¸ ì •ë³´ì—ì„œ IDë¥¼ ë°›ì•„ ì‚¬ìš©í•œë‹¤.