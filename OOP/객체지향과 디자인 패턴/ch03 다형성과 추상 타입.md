<!-- TOC -->
* [3.2 ì¶”ìƒ íƒ€ì…ì„ ì´ìš©í•œ êµ¬í˜„ êµì²´ì˜ ìœ ì—°í•¨](#32-ì¶”ìƒ-íƒ€ì…ì„-ì´ìš©í•œ-êµ¬í˜„-êµì²´ì˜-ìœ ì—°í•¨)
  * [ByteSourceì˜ ì¢…ë¥˜ê°€ ë³€ê²½ë˜ë”ë¼ë„ FlowControllerê°€ ë°”ë€Œì§€ ì•Šë„ë¡ í•˜ëŠ” ë²•](#bytesourceì˜-ì¢…ë¥˜ê°€-ë³€ê²½ë˜ë”ë¼ë„-flowcontrollerê°€-ë°”ë€Œì§€-ì•Šë„ë¡-í•˜ëŠ”-ë²•)
  * [ê°ì²´ë¥¼ ìƒì„± ê³¼ì •ì„ ì¶”ìƒí™”](#ê°ì²´ë¥¼-ìƒì„±-ê³¼ì •ì„-ì¶”ìƒí™”)
  * [ì¶”ìƒí™” ê³¼ì •ì„ í†µí•´ ì–»ì€ ìœ ì—°í•¨](#ì¶”ìƒí™”-ê³¼ì •ì„-í†µí•´-ì–»ì€-ìœ ì—°í•¨)
  * [ì±…ì„ì˜ í¬ê¸°ê°€ ì‘ì•„ì§ˆìˆ˜ë¡ ë³€ê²½ì— ëŒ€í•œ ìœ ì—°í•¨ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤](#ì±…ì„ì˜-í¬ê¸°ê°€-ì‘ì•„ì§ˆìˆ˜ë¡-ë³€ê²½ì—-ëŒ€í•œ-ìœ ì—°í•¨ì„-ê°€ì§ˆ-ìˆ˜-ìˆë‹¤)
    * [ì¶”ìƒí™”ë¥¼ í†µí•œ ì±…ì„ ë¶„ë¦¬](#ì¶”ìƒí™”ë¥¼-í†µí•œ-ì±…ì„-ë¶„ë¦¬)
<!-- TOC -->

# 3.2 ì¶”ìƒ íƒ€ì…ì„ ì´ìš©í•œ êµ¬í˜„ êµì²´ì˜ ìœ ì—°í•¨

> **_ì¶”ìƒí™”ëŠ” ë³€ê²½ì˜ ìœ ì—°í•¨ì„ ì¦ê°€ì‹œì¼œì¤€ë‹¤._**

```java
public class FlowController {

    private boolean useFile;

    public FlowController(boolean useFile) {
        this.useFile = useFile;
    }

    public void process() {
        ByteSource source = null;

        // ì´ ë¶€ë¶„ì„ ì²˜ë¦¬í•˜ì§€ ì•Šìœ¼ë©´ FlowControllerëŠ” ì—¬ì „íˆ ì‚¬ìš©í•  ByteSourceì˜ ì½˜í¬ë¦¬íŠ¸ í´ë˜ìŠ¤ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ í•¨ê»˜ ë³€ê²½ëœë‹¤.
        if (useFile) {
            source = new FileDataReader();
        } else {
            source = new SocketDataReader();
        }

        final byte[] data = source.read();

        final Encryptor encryptor = new Encryptor();
        final byte[] encryptedData = encryptor.encrypt(data);

        final FileDataWriter writer = new FileDataWriter();
        writer.write(encryptedData);
    }

}
```

## ByteSourceì˜ ì¢…ë¥˜ê°€ ë³€ê²½ë˜ë”ë¼ë„ FlowControllerê°€ ë°”ë€Œì§€ ì•Šë„ë¡ í•˜ëŠ” ë²•

1. ByteSource íƒ€ì…ì˜ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ì„ ë³„ë„ ê°ì²´ë¡œ ë¶„ë¦¬ í›„, ê·¸ ê°ì²´ë¥¼ ì‚¬ìš©í•´ì„œ ByteSourceê°ì²´ ìƒì„±
2. ìƒì„±ì(ë˜ëŠ” ë‹¤ë¥¸ ë©”ì„œë“œë¥¼)í†µí•´ ì‚¬ìš©í•  ByteSourceë¥¼ ì£¼ì… ë°›ëŠ”ë‹¤.

## ê°ì²´ë¥¼ ìƒì„± ê³¼ì •ì„ ì¶”ìƒí™”

```java
public class ByteSourceFactory {

    private static final ByteSourceFactory INSTANCE = new ByteSourceFactory();

    public static ByteSourceFactory getInstance() {
        return INSTANCE;
    }

    // ê°ì²´ ìƒì„± ê¸°ëŠ¥ì„ ìœ„í•œ ì˜¤í¼ë ˆì´ì…˜ ì •ì˜
    public ByteSource create() {
        if (useFile()) {
            return new FileDataReader();
        }
        return new SocketDataReader();
    }

    private boolean useFile() {
        final String useFileValue = System.getProperty("useFile");
        return Boolean.parseBoolean(useFileValue);
    }

}

public class FlowController {
    
    // ...
    
    public void process() {
        final ByteSource source = ByteSourceFactory.getInstance().create();

        final byte[] data = source.read();

        final Encryptor encryptor = new Encryptor();
        final byte[] encryptedData = encryptor.encrypt(data);

        final FileDataWriter writer = new FileDataWriter();
        writer.write(encryptedData);
    }

}
```

- ByteSourceFactory í´ë˜ìŠ¤ì˜ create() ë©”ì„œë“œëŠ” ByteSource íƒ€ì…ì˜ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µ
  - ğŸ‘‰ ByteSourceFactory í´ë˜ìŠ¤ëŠ” ByteSource íƒ€ì…ì˜ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì •ì„ ì¶”ìƒí™” í–ˆë‹¤ê³  ë³¼ ìˆ˜ ìˆë‹¤.

<br>

## ì¶”ìƒí™” ê³¼ì •ì„ í†µí•´ ì–»ì€ ìœ ì—°í•¨

1. ByteSourceì˜ ì¢…ë¥˜ê°€ ë³€ê²½ë˜ë©´, ByteSourceFactoryë§Œ ë³€ê²½ë  ë¿, FlowController í´ë˜ìŠ¤ëŠ” ë³€ê²½ë˜ì§€ ì•ŠìŒ. (ë°”ì´íŠ¸ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ê³¼ì •ì„ ì¶”ìƒí™”)
2. FlowControllerì˜ ì œì–´ íë¦„ì„ ë³€ê²½í•  ë•Œ, ByteSourceì˜ ê°ì²´ ìƒì„± ë¶€ë¶„ì€ ì˜í–¥ì„ ì£¼ì§€ ì•Šìœ¼ë©´ì„œ FlowControllerë§Œ ë³€ê²½í•˜ë©´ ëœë‹¤.

<br>

## ì±…ì„ì˜ í¬ê¸°ê°€ ì‘ì•„ì§ˆìˆ˜ë¡ ë³€ê²½ì— ëŒ€í•œ ìœ ì—°í•¨ì„ ê°€ì§ˆ ìˆ˜ ìˆë‹¤

```java
public void process() {
    // ë°ì´í„° ì½ê¸° ê°ì²´ ì§ì ‘ ìƒì„±
    final FileDataReader reader = new FileDataReader(); 

    // íë¦„ ì œì–´ 1: ì½ê¸°
    final byte[] data = reader.read();

    // íë¦„ ì œì–´ 2: ì•”í˜¸í™”
    final Encryptor encryptor = new Encryptor();
    final byte[] encryptedData = encryptor.encrypt(data);

    // íë¦„ ì œì–´ 3: ì“°ê¸°
    final FileDataWriter writer = new FileDataWriter();
    writer.write(encryptedData);
}
```

- ìœ„ ì½”ë“œì—ëŠ” ë‘ ê°€ì§€ ì±…ì„ì„ ë™ì‹œì— ê°–ê³  ìˆë‹¤.
  1. ë°ì´í„°ë¥¼ ì½ì–´ ì˜¤ëŠ” ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì±…ì„
  2. íë¦„ì„ ì œì–´í•˜ëŠ” ì±…ì„
- ë”°ë¼ì„œ **ê°ì²´ ìƒì„± ë°©ì‹ì— ë³€í™”ê°€ ìˆê±°ë‚˜, ì œì–´ íë¦„ì— ë³€í™”ê°€ ìˆì„ ë•Œ ëª¨ë‘ FlowControllerë¥¼ ìˆ˜ì •í•´ì¤„ ìˆ˜ ë°–ì—ì—†ëŠ” ê²ƒì´ë‹¤..!** (ê·¸ ì±…ì„ì„ ì´ ê°ì²´ê°€ ê°€ì§€ê³  ìˆìœ¼ë‹ˆê¹Œ!)

<br>

### ì¶”ìƒí™”ë¥¼ í†µí•œ ì±…ì„ ë¶„ë¦¬

```java
public void process() {
    final ByteSource source = ByteSourceFactory.getInstance().create();

    final byte[] data = source.read();

    final Encryptor encryptor = new Encryptor();
    final byte[] encryptedData = encryptor.encrypt(data);

    final FileDataWriter writer = new FileDataWriter();
    writer.write(encryptedData);
}
```

- ë‘ ë²ˆì˜ ì¶”ìƒí™”ë¥¼ í†µí•´ FlowControllerì—ì„œ ì±…ì„ì„ ë¶„ë¦¬í•´ë‚¼ ìˆ˜ ìˆì—ˆìŒ.
  1. ë°”ì´íŠ¸ ë°ì´í„°ë¥¼ ì½ê¸°: ByteSource ì¸í„°í˜ì´ìŠ¤ë¥¼ ë„ì¶œ
  2. ByteSource ê°ì²´ë¥¼ ìƒì„±í•˜ê¸°: ByteSourceFactory ë„ì¶œ
- ì¶”ìƒí™”ëŠ” ê³µí†µëœ ê°œë…ì„ ë„ì¶œí•´ì„œ ì¶”ìƒ íƒ€ì…ì„ ì •ì˜í•´ ì£¼ê¸°ë„ í•˜ì§€ë§Œ, **ì±…ì„ì´ ë§ì€ ê°ì²´ë¡œë¶€í„° ì±…ì„ì„ ë¶„ë¦¬í•˜ëŠ” ì‹œë°œì ì´ ë˜ê¸°ë„ í•¨.**

```mermaid
classDiagram

class FlowController {
    +create()
}

FlowController ..> ByteSourceFactory
FlowController ..> ByteSource

ByteSourceFactory ..> FileDataReader : instantiate
ByteSourceFactory ..> SocketDataReader : instantiate


class ByteSourceFactory {
    +create() ByteSource
}

class ByteSource {
    <<interface>>
    +read() byte[]
}
class FileDataReader {
    +read()
}
class SocketDataReader {
    +read()
}

ByteSource <|-- FileDataReader : implements
ByteSource <|-- SocketDataReader : implements
```