<!-- TOC -->
* [íŠ¸ëœì­ì…˜](#íŠ¸ëœì­ì…˜-)
  * [íŠ¸ëœì­ì…˜ ê°œë… ì´í•´](#íŠ¸ëœì­ì…˜-ê°œë…-ì´í•´)
  * [ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° êµ¬ì¡°ì™€ DB ì„¸ì…˜](#ë°ì´í„°ë² ì´ìŠ¤-ì—°ê²°-êµ¬ì¡°ì™€-db-ì„¸ì…˜)
* [íŠ¸ëœì­ì…˜ DB ì˜ˆì œ](#íŠ¸ëœì­ì…˜-db-ì˜ˆì œ)
  * [íŠ¸ëœì­ì…˜ - ìë™ ì»¤ë°‹, ìˆ˜ë™ ì»¤ë°‹](#íŠ¸ëœì­ì…˜---ìë™-ì»¤ë°‹-ìˆ˜ë™-ì»¤ë°‹)
    * [ìë™ ì»¤ë°‹](#ìë™-ì»¤ë°‹)
    * [ìˆ˜ë™ ì»¤ë°‹](#ìˆ˜ë™-ì»¤ë°‹)
  * [íŠ¸ëœì­ì…˜ - íŠ¸ëœì­ì…˜ ì‹¤ìŠµ](#íŠ¸ëœì­ì…˜---íŠ¸ëœì­ì…˜-ì‹¤ìŠµ)
  * [íŠ¸ëœì­ì…˜ - ê³„ì¢Œ ì´ì²´](#íŠ¸ëœì­ì…˜---ê³„ì¢Œ-ì´ì²´)
    * [ê³„ì¢Œì´ì²´ ì •ìƒ](#ê³„ì¢Œì´ì²´-ì •ìƒ)
    * [ê³„ì¢Œì´ì²´ ë¬¸ì œ ìƒí™© - ì»¤ë°‹](#ê³„ì¢Œì´ì²´-ë¬¸ì œ-ìƒí™©---ì»¤ë°‹)
    * [ê³„ì¢Œì´ì²´ ë¬¸ì œ ìƒí™© - ë¡¤ë°±](#ê³„ì¢Œì´ì²´-ë¬¸ì œ-ìƒí™©---ë¡¤ë°±)
    * [ì •ë¦¬ (ì›ìì„±, ì˜¤í†  ì»¤ë°‹, íŠ¸ëœì­ì…˜ ì‹œì‘)](#ì •ë¦¬-ì›ìì„±-ì˜¤í† -ì»¤ë°‹-íŠ¸ëœì­ì…˜-ì‹œì‘)
* [DB ë½](#db-ë½)
  * [DB ë½ - ê°œë… ì´í•´](#db-ë½---ê°œë…-ì´í•´)
  * [DB ë½ - ë³€ê²½](#db-ë½---ë³€ê²½)
  * [DB ë½ - ì¡°íšŒ](#db-ë½---ì¡°íšŒ)
* [íŠ¸ëœì­ì…˜ ì ìš©](#íŠ¸ëœì­ì…˜-ì ìš©)
<!-- TOC -->


# íŠ¸ëœì­ì…˜ 

## íŠ¸ëœì­ì…˜ ê°œë… ì´í•´

## ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° êµ¬ì¡°ì™€ DB ì„¸ì…˜

# íŠ¸ëœì­ì…˜ DB ì˜ˆì œ

## íŠ¸ëœì­ì…˜ - ìë™ ì»¤ë°‹, ìˆ˜ë™ ì»¤ë°‹

- ìë™/ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œëŠ” í•œ ë²ˆ ì„¤ì •í•˜ë©´ í•´ë‹¹ ì„¸ì…˜ì—ì„œëŠ” ê³„ì† ìœ ì§€ë¨. ì¤‘ê°„ì— ë³€ê²½ì€ ê°€ëŠ¥

### ìë™ ì»¤ë°‹

```sql
set autocommit true; //ìë™ ì»¤ë°‹ ëª¨ë“œ ì„¤ì •
insert into member(member_id, money) values ('data1',10000); //ìë™ ì»¤ë°‹ 
insert into member(member_id, money) values ('data2',10000); //ìë™ ì»¤ë°‹
```

- ì¿¼ë¦¬ í•˜ë‚˜ í•˜ë‚˜ ì‹¤í–‰í•  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ì»¤ë°‹ ë˜ê¸° ë•Œë¬¸ì— ì›í•˜ëŠ” ëŒ€ë¡œ íŠ¸ëœì­ì…˜ ìˆ˜í–‰í•˜ê¸° ì–´ë ¤ì›€.

### ìˆ˜ë™ ì»¤ë°‹

```sql
set autocommit false; //ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œ ì„¤ì •

insert into member(member_id, money) values ('data3',10000);
insert into member(member_id, money) values ('data4',10000);

commit; //ìˆ˜ë™ ì»¤ë°‹
```

- **ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„ íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤**ê³  í‘œí˜„í•œë‹¤.
- ìˆ˜ë™ ì»¤ë°‹ ì„¤ì • ì´í›„ì—ëŠ” ê¼­ `commit` ë˜ëŠ” `rollback` ì„ í•´ì•¼í•œë‹¤.
  - ì»¤ë°‹ì´ë‚˜ ë¡¤ë°±ì„ ì•ˆ í•˜ë©´ timeoutìœ¼ë¡œ ì¸í•´ ìë™ìœ¼ë¡œ ë¡¤ë°±ì´ ì¼ì–´ë‚œë‹¤. 

## íŠ¸ëœì­ì…˜ - íŠ¸ëœì­ì…˜ ì‹¤ìŠµ

 
![img.png](img/img.png)

ì„¸ì…˜ 1ì—ì„œ ì‹ ê·œ ë°ì´í„°ë¥¼ ìˆ˜ë™ ì»¤ë°‹ìœ¼ë¡œ ì¶”ê°€í•˜ê³ , ì¡°íšŒí•œë‹¤.

```sql
set autocommit false; 
insert into member(member_id, money) values ('newId1',10000); 
insert into member(member_id, money) values ('newId2',10000);

select * from member;
```

![img_1.png](img/img_1.png)


ì´ ë•Œ ì„¸ì…˜ 2ì—ì„œ ì¡°íšŒí•˜ë©´, íŠ¸ëœì­ì…˜ `commit` ì „ì´ë¯€ë¡œ ì¡°íšŒ ì•ˆ ëœë‹¤.

![img_2.png](img/img_2.png)


ì„¸ì…˜ 1ì—ì„œ commit í•˜ê³  ë‹¤ì‹œ ì¡°íšŒí•˜ë©´ ì •ìƒì ìœ¼ë¡œ ë³´ì¸ë‹¤.

![img_3.png](img/img_3.png)

([H2 Databaseì˜ ê¸°ë³¸ íŠ¸ëœì­ì…˜ ê²©ë¦¬ ìˆ˜ì¤€ì€ `Read Committed`](https://www.h2database.com/html/advanced.html#transaction_isolation))

## íŠ¸ëœì­ì…˜ - ê³„ì¢Œ ì´ì²´

![img.png](img/img2/img.png)

### ê³„ì¢Œì´ì²´ ì •ìƒ

1. ì´ˆê¸°í™” SQL

```sql
set autocommit true;
delete from member;
insert into member(member_id, money) values ('memberA',10000);
insert into member(member_id, money) values ('memberB',10000);
```

2. ê³„ì¢Œì´ì²´ ì‹¤í–‰ SQL - ì„±ê³µ

```sql
# ì„¸ì…˜ 1ì—ì„œ ìˆ˜í–‰
set autocommit false;
update member set money=10000 - 2000 where member_id = 'memberA';
update member set money=10000 + 2000 where member_id = 'memberB';
```

- ì´ ì‹œì ì—ì„œ ì„¸ì…˜ 1ì—ì„œëŠ” moneyëŠ” ê°ê° 8000/12000ìœ¼ë¡œ ë³´ì´ê³ ,
  - ì„¸ì…˜ 2ì—ì„œëŠ” moneyëŠ” ê°ê° 10000/10000ìœ¼ë¡œ ë³´ì¸ë‹¤.
    - ğŸ‘‰ íŠ¸ëœì­ì…˜ ê²©ë¦¬ ë ˆë²¨ì´ `Read Committed`ë¼ì„œ, `Dirty Read`ê°€ ë°©ì§€ëœë‹¤.

3. `commit`

```sql
commit; # ì„¸ì…˜ 1ì—ì„œ ìˆ˜í–‰
```

![img_1.png](img/img2/img_1.png)

- ì„¸ì…˜ 2ì—ì„œë„ ì •ìƒì ìœ¼ë¡œ ê¸ˆì•¡ì´ ë…¸ì¶œë˜ëŠ” ê²ƒì„ í™•ì¸. 

<br>

### ê³„ì¢Œì´ì²´ ë¬¸ì œ ìƒí™© - ì»¤ë°‹

1. ë¬¸ì œê°€ ë°œìƒí•˜ëŠ” SQL

```h2
// ì´ˆê¸°í™” SQL
set autocommit true;
delete from member;
insert into member(member_id, money) values ('memberA',10000);
insert into member(member_id, money) values ('memberB',10000);
  
// ë¬¸ì œ ë°œìƒ SQL. ì„¸ì…˜ 1ì—ì„œ ì‹¤í–‰
set autocommit false;
update member set money=10000 - 2000 where member_id = 'memberA'; // ì„±ê³µ 
update member set money=10000 + 2000 where member_iddd = 'memberB'; // ì¿¼ë¦¬ ì˜ˆì™¸ ë°œìƒ
```

- ì´ˆê¸°í™”í•˜ê³ , ìœ„ SQLì„ ì„¸ì…˜ 1ì—ì„œ ì‹¤í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.

![img_2.png](img/img2/img_2.png)

_(`MEMBER_IDDD` ë¼ëŠ” ì»¬ëŸ¼ì„ ëª» ì°¾ì•˜ë‹¤ëŠ” ì—ëŸ¬.)_

![img_5.png](img/img2/img_5.png)

![img_3.png](img/img2/img_3.png)

- ì´ ìƒí™©ì—ì„œ ì„¸ì…˜ 1ì—ì„œ ì¡°íšŒí•œ ê²½ìš° memberAì˜ moneyëŠ” -2000.

![img_4.png](img/img2/img_4.png)

- ì„¸ì…˜ 2ì—ì„œ ì¡°íšŒí•œ ê²½ìš°ëŠ” ì»¤ë°‹ ì „ì´ë¯€ë¡œ ë‹¹ì—°íˆ ê·¸ëŒ€ë¡œì´ë‹¤.

2. `commit`

![img_6.png](img/img2/img_6.png)

- ì´ ìƒíƒœë¡œ ì»¤ë°‹í•˜ê²Œ ë˜ë©´ ì„¸ì…˜ 1, 2 ëª¨ë‘ memberAì˜ ì”ì•¡ì´ -2000 ì¸ ìƒíƒœë¡œ ì¡°íšŒëœë‹¤.
- **Aì˜ ëˆë§Œ ë¹ ì ¸ë‚˜ê°„ ì•„ì£¼ ì‹¬ê°í•œ ìƒíƒœì´ë‹¤.**

<br>

### ê³„ì¢Œì´ì²´ ë¬¸ì œ ìƒí™© - ë¡¤ë°±

1. ë¬¸ì œì˜ SQL ì‹¤í–‰

```h2
// ì´ˆê¸°í™”
set autocommit true;
delete from member;
insert into member(member_id, money) values ('memberA',10000);
insert into member(member_id, money) values ('memberB',10000);


set autocommit false;
update member set money=10000 - 2000 where member_id = 'memberA'; //ì„±ê³µ 
update member set money=10000 + 2000 where member_iddd = 'memberB'; //ì¿¼ë¦¬ ì˜ˆì™¸ ë°œìƒ
```

![img_7.png](img/img2/img_7.png)

- ë‘ ë²ˆì§¸ update ë¬¸ì—ì„œ ì—ëŸ¬ê°€ ë‚œ ìƒí™©ì—ì„œ, ì´ë²ˆì—” ë¡¤ë°±ì„ í•´ë³´ì.

2. `rollback`

```h2
rollback;
```

![img_8.png](img/img2/img_8.png)

- ë¡¤ë°±ì„ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ ê³„ì¢Œì´ì²´ ì‹¤í–‰ ì „ ìƒíƒœë¡œ ë˜ëŒì•„ì™”ë‹¤.

### ì •ë¦¬ (ì›ìì„±, ì˜¤í†  ì»¤ë°‹, íŠ¸ëœì­ì…˜ ì‹œì‘)

- ì›ìì„±
  - íŠ¸ëœì­ì…˜ ë‚´ì—ì„œ ì‹¤í–‰ëœ ì‘ì—…ì€ í•˜ë‚˜ì˜ ì‘ì—…ì²˜ëŸ¼ ëª¨ë‘ ì„±ê³µí•˜ê±°ë‚˜ ëª¨ë‘ ì‹¤íŒ¨í•´ì•¼í•¨.
  - ì›ìì„± ë•ë¶„ì— ì—¬ëŸ¬ SQLì„ í•˜ë‚˜ì˜ ì‘ì—…ì¸ ê²ƒì²˜ëŸ¼ ì²˜ë¦¬ ê°€ëŠ¥í•´ì§„ë‹¤.
    - ì„±ê³µí•˜ë©´ í•œ ë²ˆì— ë°˜ì˜, ì¤‘ê°„ì— ì‹¤íŒ¨í•˜ë©´ í•˜ë‚˜ì˜ ì‘ì—…ì²˜ëŸ¼ ë˜ëŒë¦¼.
- ì˜¤í†  ì»¤ë°‹
  - ì˜¤í†  ì»¤ë°‹ì„ ì“°ëŠ”ë°, ì¤‘ê°„ì— ê³„ì¢Œ ì´ì²´ê°€ ì‹¤íŒ¨í•˜ë©´ ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•¨.
- íŠ¸ëœì­ì…˜ ì‹œì‘
  - ìœ„ ê°™ì€ ì‘ì—…ì€ ë°˜ë“œì‹œ ìˆ˜ë™ ì»¤ë°‹ì„ ì¨ì•¼í•˜ë©°, ìë™ ì»¤ë°‹ì—ì„œ ìˆ˜ë™ ì»¤ë°‹ ëª¨ë“œë¡œ ì „í™˜í•˜ëŠ” ê²ƒì„ **íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•œë‹¤ê³  í‘œí˜„í•œë‹¤.**


# DB ë½

## DB ë½ - ê°œë… ì´í•´

## DB ë½ - ë³€ê²½

## DB ë½ - ì¡°íšŒ

# íŠ¸ëœì­ì…˜ ì ìš©

