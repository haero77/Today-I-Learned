# ìˆœìˆ˜ JPA ë¦¬í¬ì§€í† ë¦¬ì™€ Querydsl

## ìˆœìˆ˜ JPA ë¦¬í¬ì§€í† ë¦¬

```java
@Repository
public class MemberJpaRepository {

	private final EntityManager em;
	private final JPAQueryFactory queryFactory;

	public MemberJpaRepository(EntityManager em) {
		this.em = em;
		this.queryFactory = new JPAQueryFactory(em);
	}

	public void save(Member member) {
		em.persist(member);
	}

	public Optional<Member> findById(Long id) {
		Member findMember = em.find(Member.class, id);
		return Optional.ofNullable(findMember);
	}

	public List<Member> findAll() {
		return em.createQuery("select m from Member m", Member.class)
				.getResultList();
	}
	
	public List<Member> findByUsername(String username) {
		return em.createQuery("select m from Member m where m.username = :username", Member.class)
				.setParameter("username", username)
				.getResultList();
	}

}
```

- ìƒì„±ìì—ì„œ `EntityManager`ë§Œ ì£¼ì…ë°›ê³  `JPAQueryFactory`ëŠ” ê°ì²´ë¥¼ ìƒì„±í•´ì„œ ì‚¬ìš©í•œë‹¤.
- `JPAQueryFactory`ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ë©´ `@RequiredArgsConstructor`ë¥¼ ì´ìš©í•´ ì£¼ì…ë°›ì„ ìˆ˜ ìˆë‹¤.

<br>

### Querydslë¡œ ë°”ê¾¸ê¸° 

```java
public List<Member> findAllQuerydsl() {
    return queryFactory
            .selectFrom(member) // QMember.member ì—ì„œ QMember ë¥¼ static import
            .fetch();
}

public List<Member> findByUsernameQuerydsl(String username) {
    return queryFactory
        .selectFrom(member)
        .where(member.username.eq(username))
        .fetch();
}
```

- JPQLì„ ì‚¬ìš©í•˜ë©´ ëŸ°íƒ€ì„ì— ì—ëŸ¬ë¥¼ ì¡ì§€ë§Œ, Querydslì„ ì‚¬ìš©í•˜ë©´ ì»´íŒŒì¼ íƒ€ì„ì— ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤.
  - ğŸ‘‰ ë³µì¡í•œ ì¿¼ë¦¬ì—ì„œ ì£¼ë¡œ Querydslì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ì´ë‹¤.

<br>

## JPAQueryFactory ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ê¸°

```java
@SpringBootApplication
public class QuerydslApplication {

	public static void main(String[] args) {
		SpringApplication.run(QuerydslApplication.class, args);
	}

	@Bean
	JPAQueryFactory jpaQueryFactory(EntityManager em) {
		return new JPAQueryFactory(em);
	}

}
```

```java
public MemberJpaRepository(EntityManager em, JPAQueryFactory queryFactory) {
      this.em = em;
      this.queryFactory = queryFactory;
}
```

- ì¥ì  
  - ë³„ë„ë¡œ JPAQueryFactory ë¹ˆì„ ë“±ë¡í•˜ë©´ ë¡¬ë³µì˜ @RequiredArgsConstructor ë¡œ í¸í•˜ê²Œ ë¹ˆì£¼ì… ê°€ëŠ¥.
- ë‹¨ì 
  - ë¹ˆì„ ë³„ë„ë¡œ ì£¼ì…ë°›ì•„ì•¼ í•˜ê¸° ë•Œë¬¸ì—, í…ŒìŠ¤íŠ¸ ì½”ë“œí•  ë•Œ ë¶ˆí¸í•  ìˆ˜ ìˆë‹¤.

<br>

## ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ë©´ ë™ì‹œì„± ë¬¸ì œê°€ ìƒê¸°ì§€ ì•Šì„ê¹Œ? â­ï¸

- JPAQueryFactoryë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ë©´, ì‹±ê¸€í†¤ìœ¼ë¡œ ê´€ë¦¬ëœë‹¤.
- ê·¸ë¦¬ê³  ì´ ë¹ˆì„ ëª¨ë“  ë©€í‹° ìŠ¤ë ˆë“œì—ì„œ ê°€ì ¸ë‹¤ê°€ ì“´ë‹¤. ë™ì‹œì„± ë¬¸ì œê°€ ìƒê¸°ì§€ ì•Šì„ê¹Œ?
- ğŸ‘‰ ë¬¸ì œê°€ ì—†ë‹¤. 
  - **_JPAQueryFactoryì˜ ë™ì‹œì„± ë¬¸ì œëŠ” EntityManager ì— ì˜ì¡´í•œë‹¤._**
  - EntityManagerë¥¼ ìŠ¤í”„ë§ê³¼ í†µí•©í•˜ì—¬ ì‚¬ìš©í•˜ë©´, 
    - ë™ì‹œì„± ë¬¸ì œë‘ ê´€ê³„ì—†ì´ íŠ¸ëœì­ì…˜ ë‹¨ìœ„ë¡œ ë¶„ë¦¬ë˜ì–´ ë™ì‘í•œë‹¤. 
  - **_ìŠ¤í”„ë§ì—ì„œëŠ” ì§„ì§œ EntityManager ê°€ ì•„ë‹ˆë¼ EntityMangerProxy ê°€ ì£¼ì…ëœë‹¤._**
    - ì‹¤ì œ ë™ì‘ ì‹œì ì— ì§„ì§œ ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ ì°¾ì•„ì£¼ëŠ” í”„ë¡ì‹œìš© ê°€ì§œ ì—”í‹°í‹° ë§¤ë‹ˆì € ì£¼ì…. 
    - **ê°€ì§œ ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ì‹¤ì œ ì‚¬ìš© ì‹œì ì— íŠ¸ëœì­ì…˜ ë‹¨ìœ„ë¡œ ì‹¤ì œ ì—”í‹°í‹° ë§¤ë‹ˆì €(ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸)ë¥¼ í• ë‹¹**í•´ì¤€ë‹¤.
    - (JPA ì±… 13.1 íŠ¸ëœì­ì…˜ ë²”ìœ„ì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ ì°¸ê³ )