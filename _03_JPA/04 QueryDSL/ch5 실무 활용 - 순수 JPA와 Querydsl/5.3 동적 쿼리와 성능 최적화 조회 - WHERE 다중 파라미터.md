# ë™ì  ì¿¼ë¦¬ì™€ ì„±ëŠ¥ ìµœì í™” ì¡°íšŒ - WHERE ë‹¤ì¤‘ íŒŒë¼ë¯¸í„°

- BooleanBuilder ì™€ëŠ” ë‹¤ë¥´ê²Œ, WHERE ë‹¤ì¤‘ íŒŒë¼ë¯¸í„°ë¥¼ ì´ìš©í•˜ë©´ ì‹¤ì œ ì¿¼ë¦¬ì™€ íë¦„ ìˆœì„œë„ ì¼ì¹˜í•˜ê³ , ê°€ë…ì„±ì´ ì¢‹ë‹¤.

<br>

## ë‹¤ì¤‘ íŒŒë¼ë¯¸í„° ì‚¬ìš©í•˜ê¸°

```java
@Data
public class MemberTeamDto {

	private Long memberId;
	private String username;
	private int age;
	private Long teamId;
	private String teamName;

	@QueryProjection
	public MemberTeamDto(Long memberId, String username, int age, Long teamId, String teamName) {
		this.memberId = memberId;
		this.username = username;
		this.age = age;
		this.teamId = teamId;
		this.teamName = teamName;
	}

}
```

```java
public List<MemberTeamDto> search(MemberSearchCondition condition) {
    return queryFactory
            .select(new QMemberTeamDto(
                    member.id.as("memberId"),
                    member.username,
                    member.age,
                    team.id.as("teamId"),
                    team.name.as("teamName")))
            .from(member)
            .leftJoin(member.team, team)
            .where(
                    usernameEq(condition.getUsername()),
                    teamNameEq(condition.getTeamName()),
                    ageGoe(condition.getAgeGoe()),
                    ageLoe(condition.getAgeLoe())
            )
            .fetch();
}


/**
 * Predicate ë³´ë‹¤ BooleanExpression ì´ ë‚«ë‹¤.
 * ğŸ‘‰ë‹¤ë¥¸ Expression ë“¤ê³¼ ì¡°í•©(Composition)ì´ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸
 */
private BooleanExpression usernameEq(String username) {
    return hasText(username) ? member.username.eq(username) : null;
}

private BooleanExpression teamNameEq(String teamName) {
    return hasText(teamName) ? team.name.eq(teamName) : null;
}

private BooleanExpression ageGoe(Integer ageGoe) {
    return ageGoe != null ? member.age.goe(ageGoe) : null;
}

private BooleanExpression ageLoe(Integer ageLoe) {
    return ageLoe != null ? member.age.loe(ageLoe) : null;
}
```

- DAO ê°ì²´ì— ë‹¤ì¤‘ íŒŒë¼ë¯¸í„°ë¥¼ ì´ìš©í•˜ì—¬ ì¡°ê±´ì ˆì— í•„ìš”í•œ ì¡°ê±´ë“¤ì„ ë©”ì„œë“œë¡œ ë¶„ë¦¬í•´ë‚¸ë‹¤.
- ë°˜í™˜íƒ€ì…ìœ¼ë¡œëŠ” `Predicate` ë³´ë‹¤ ì´ê²ƒì„ êµ¬í˜„í•˜ëŠ” ì¶”ìƒí´ë˜ìŠ¤ `BooleanExpression` ì„ ì‚¬ìš©í•˜ì.
  - Predicate ê³¼ëŠ” ë‹¤ë¥´ê²Œ ë‹¤ë¥¸ BooleanExpression ê³¼ ì¡°í•©(Compostion)í•˜ì—¬ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‹¤.

<br>

## ë‹¤ì¤‘ íŒŒë¼ë¯¸í„°ì˜ ì¥ì : ì¬ì‚¬ìš©

- WHERE ë‹¤ì¤‘ íŒŒë¼ë¯¸í„°ì˜ ì§„ë©´ëª©ì€ ì¬ì‚¬ìš©ì— ìˆë‹¤.
- ì´ë²ˆì—ëŠ” DTOê°€ ì•„ë‹Œ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•´ì•¼í•œë‹¤ê³  í•´ë³´ì.

```java
public List<MemberTeamDto> search(MemberSearchCondition condition) {
    return queryFactory
            .select(new QMemberTeamDto(
                    member.id.as("memberId"),
                    member.username,
                    member.age,
                    team.id.as("teamId"),
                    team.name.as("teamName")))
            .from(member)
            .leftJoin(member.team, team)
            .where(
                    usernameEq(condition.getUsername()),
                    teamNameEq(condition.getTeamName()),
                    ageGoe(condition.getAgeGoe()),
                    ageLoe(condition.getAgeLoe())
            )
            .fetch();
}
```

- ê¸°ì¡´ì— ì •ì˜í•œ BooleanExpression ë©”ì„œë“œë¥¼ ì¬ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤. ì¦‰ ë‹¤ì¤‘ íŒŒë¼ë¯¸í„°ë¥¼ ì‚¬ìš©í•˜ë©´, SELECT Projection ì´ ë‹¬ë¼ì ¸ë„ ì¬ì‚¬ìš© ê°€ëŠ¥í•˜ë‹¤.

<br>

### Condition ì¡°ë¦½í•˜ê¸°

- BooleanExpressionì„ ì¡°ë¦½í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.

```java
private BooleanExpression ageGoe(Integer ageGoe) {
    return ageGoe != null ? member.age.goe(ageGoe) : null;
}

private BooleanExpression ageLoe(Integer ageLoe) {
    return ageLoe != null ? member.age.loe(ageLoe) : null;
}
```
- ì´ ë‘ ê°œì˜ ë©”ì„œë“œë¥¼ ì¡°ë¦½í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆë‹¤.

```java
public BooleanExpression ageBetween(int ageGoe, int ageLoe) {
    return ageGoe(ageGoe).and(ageLoe(ageLoe));
}
```
- ë‹¤ë§Œ ì´ ë•ŒëŠ” NPE ë°œìƒ ê°€ëŠ¥ì„±ì´ ìˆìœ¼ë‹ˆ, **_NULL ì²´í¬í•˜ëŠ” ê²ƒì„ ìŠì§€ë§ì•„ì•¼ í•œë‹¤!_**

<br>

## ëª¨ë“  ì¡°ê±´ì´ NULLì´ë¼ë©´? 

- ìœ„ì— ì •ì˜í•œ MemberSearchConditionì˜ ê°’ë“¤ì´ ëª¨ë‘ NULL ì´ë¼ë©´ ì–´ë–»ê²Œ ë ê¹Œ?
- BooleanBuilder ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ `SELECT * FROM TABLE;` í˜•íƒœê°€ ëœë‹¤.


### Reference

- [WHERE ë‹¤ì¤‘ íŒŒë¼ë¯¸í„° NULL ì²´í¬í•˜ê¸°](https://www.inflearn.com/questions/94056/%EA%B0%95%EC%82%AC%EB%8B%98-where-%EB%8B%A4%EC%A4%91-%ED%8C%8C%EB%9D%BC%EB%AF%B8%ED%84%B0%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EB%8F%99%EC%A0%81-%EC%BF%BC%EB%A6%AC-%EC%82%AC%EC%9A%A9%EC%97%90-%EB%8C%80%ED%95%9C-%EC%A7%88%EB%AC%B8%EC%9E%85%EB%8B%88%EB%8B%A4)