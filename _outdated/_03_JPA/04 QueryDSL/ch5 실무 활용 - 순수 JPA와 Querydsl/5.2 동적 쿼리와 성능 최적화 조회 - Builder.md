# ë™ì  ì¿¼ë¦¬ì™€ ì„±ëŠ¥ ìµœì í™” ì¡°íšŒ

### Builder ë¥¼ ì´ìš©í•œ DTO

```java
@Data
public class MemberTeamDto {

	private Long memberId;
	private String username;
	private int age;
	private Long teamId;
	private String teamName;

	@QueryProjection
	public MemberTeamDto(Long memberId, String username, int age, Long teamId, String teamName) {
		this.memberId = memberId;
		this.username = username;
		this.age = age;
		this.teamId = teamId;
		this.teamName = teamName;
	}

}
```

- íšŒì›ê³¼ íŒ€ì—ì„œ ì›í•˜ëŠ” í•„ë“œë§Œ ì¶”ì¶œí•˜ëŠ” DTOë¥¼ ì‘ì„±.
- `@QueryProjection`ì„ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ, QType í´ë˜ìŠ¤ë¥¼ ìƒì„±í•´ì•¼í•œë‹¤.
  - Gradle > other > compileQuerydsl ì„ í†µí•´ QType í´ë˜ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.
- `@QueryProjection`ì„ ì‚¬ìš©í•¨ìœ¼ë¡œì¨, DTOê°€ í•˜ë¶€ ê¸°ìˆ ì€ Querydslì„ ì•Œê²Œ ëœë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤. 
  - DTOê°€ ìµœëŒ€í•œ ìˆœìˆ˜í•˜ë©´ ì¢‹ì€ë°, Querydsl ì˜ì¡´ì„±ì„ ê°–ëŠ” ê²ƒ ìì²´ê°€ ë‹¨ì ì´ë‹¤.

<br>

## ê²€ìƒ‰ ì¡°ê±´ ë§Œë“¤ê¸°

```java
  public List<MemberTeamDto> searchByBuilder(MemberSearchCondition memberSearchCondition) {

      return queryFactory
		.select(new QMemberTeamDto(
        		member.id.as("memberId"),
        		member.username,
        		member.age,
        		team.id.as("teamId"),
        		team.name.as("teamName")))
		.from(member)
		.leftJoin(member.team, team)
		.fetch();
}

```

- Repository DAO ê°ì²´ì— ì‘ì„±í•œë‹¤.
- **_ë™ì  ì¿¼ë¦¬ë¥¼ ë§Œë“œëŠ” ê²ƒì´ ì˜ ìƒê°ë‚˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì¼ë‹¨ ì •ì  ì¿¼ë¦¬ë¡œ ì§œê³ ë‚˜ì„œ ë™ì  ì¿¼ë¦¬ë¡œ ë³€ê²½í•˜ì._**

<br>

### BooleanBuilder

```java
  public List<MemberTeamDto> searchByBuilder(MemberSearchCondition condition) {

      BooleanBuilder builder = new BooleanBuilder();

      // null & Blank("") ë°©ì§€
      if (hasText(condition.getUsername())) {
          builder.and(member.username.eq(condition.getUsername()));
      }

      if (hasText(condition.getTeamName())) {
          builder.and(team.name.eq(condition.getTeamName()));
      }

      if (condition.getAgeGoe() != null) {
          builder.and(member.age.goe(condition.getAgeGoe()));
      }

      if (condition.getAgeLoe() != null) {
          builder.and(member.age.loe(condition.getAgeLoe()));
      }

      // ì„±ëŠ¥ ìµœì í™”: DTOë¡œ í•œ ë²ˆì— ì¡°íšŒ
      return queryFactory
              .select(new QMemberTeamDto(
                      member.id.as("memberId"),
                      member.username,
                      member.age,
                      team.id.as("teamId"),
                      team.name.as("teamName")))
              .from(member)
              .leftJoin(member.team, team)
              .where(builder)
              .fetch();
  }
```

- BooleanBuilderë¥¼ ì´ìš©í•˜ì—¬ condition ì— ë§ê²Œ and ë¥¼ ì´ìš©í•˜ì—¬ ê²€ìƒ‰ ì¡°ê±´ì„ ì¶”ê°€í•œë‹¤. 
- `hasText()`ëŠ” StringUtils ì˜ ì •ì  ë©”ì†Œë“œ. 
  - null ê³¼ Blank ê°’ì¸ `""` ë¥¼ í™•ì¸í•œë‹¤.
- where ì ˆì— builderë¥¼ ì‚¬ìš©í•˜ì—¬ ê²€ìƒ‰ ì¡°ê±´ì„ ëª…ì‹œí•œë‹¤.

<br>

### í…ŒìŠ¤íŠ¸ ì½”ë“œ

```java
@Test
@DisplayName("Search By Builder")
void searchTest() {
    // given
    Team teamA = new Team("teamA");
    Team teamB = new Team("teamB");
    em.persist(teamA);
    em.persist(teamB);

    Member member1 = new Member("member1", 10, teamA);
    Member member2 = new Member("member2", 20, teamA);
    Member member3 = new Member("member3", 30, teamB);
    Member member4 = new Member("member4", 40, teamB);
    em.persist(member1);
    em.persist(member2);
    em.persist(member3);
    em.persist(member4);

    MemberSearchCondition condition = new MemberSearchCondition();
    condition.setAgeGoe(35);
    condition.setAgeLoe(40);
    condition.setTeamName("teamB");

    // when
    List<MemberTeamDto> result = memberJpaRepository.searchByBuilder(condition);

    // then
    assertThat(result)
            .extracting("username")
            .containsExactly("member4");
}
```
```sql
select
    member0_.member_id as col_0_0_,
    member0_.username as col_1_0_,
    member0_.age as col_2_0_,
    team1_.team_id as col_3_0_,
    team1_.name as col_4_0_ 
from
    member member0_ 
left outer join
    team team1_ 
        on member0_.team_id=team1_.team_id 
where
    team1_.name=? 
    and member0_.age>=? 
    and member0_.age<=?
```

- `username`ì— ëŒ€í•œ ì¡°ê±´ì€ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì¿¼ë¦¬ë¥¼ í™•ì¸í•˜ë©´ ì¡°ê±´ 3ê°œë§Œ ì‚¬ìš©ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.



<br>

## Builder ì‚¬ìš© ì‹œ ì£¼ì˜ì : ì¼ì¹˜í•˜ëŠ” ì¡°ê±´ì´ ì—†ë‹¤ë©´ ëª¨ë‘ SELECT â­ï¸

- ìœ„ ì˜ˆì œì—ì„œ conditionì— í•´ë‹¹í•˜ëŠ” ê°’ë“¤ì´ ì „ë¶€ null ì´ë¼ë©´ ì–´ë–»ê²Œ ë ê¹Œ?
- ğŸ‘‰ ë°ì´í„°ê°€ 3ë§Œ ê±´ì´ë¼ë©´, 3ë§Œ ê±´ì„ í•œ ë²ˆì˜ ì¿¼ë¦¬ë¡œ ì¡°íšŒí•˜ê²Œ ë˜ë‹ˆ ì‹¬ê°í•œ ì„±ëŠ¥ ì´ìŠˆ ë°œìƒ.