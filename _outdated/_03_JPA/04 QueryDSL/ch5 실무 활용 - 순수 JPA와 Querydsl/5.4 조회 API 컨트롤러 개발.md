# ì¡°íšŒ API ì»¨íŠ¸ë¡¤ëŸ¬ ê°œë°œ

- ì´ì „ì— WHERE ë‹¤ì¤‘ íŒŒë¼ë¯¸í„°ë¥¼ ì´ìš©í•´ ê°œë°œí•œ íšŒì›-íŒ€ ì¡°íšŒ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´, ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ êµ¬í˜„í•œë‹¤.

<br>

## ìƒ˜í”Œ ë°ì´í„° ì¶”ê°€ 

```java
package inf.querydsl.controller;

@Profile("local")
@Component
@RequiredArgsConstructor
public class InitMember {

	private final InitMemberService initMemberService;

	@PostConstruct
	public void init() {
		this.initMemberService.init();
	}

	@Component
	static class InitMemberService {

		@PersistenceContext
		EntityManager em;

		@Transactional
		public void init() {
			Team teamA = new Team("teamA");
			Team teamB = new Team("teamB");
			em.persist(teamA);
			em.persist(teamB);

			for (int i = 0; i < 100; i++) {
				Team selectedTeam = i % 2 == 0 ? teamA : teamB;
				em.persist(new Member("member" + i, i, selectedTeam));
			}
		}

	}

}

```

- ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì´ìš©í•˜ì—¬ APIë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´, ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì‹¤í–‰ ëœ ë‹¤ìŒ ë°ì´í„°ë¥¼ ì‚½ì…í•˜ëŠ” ë¡œì§ì„ ì‘ì„±í•œë‹¤.

```java
@PostConstruct
public void init() {
    this.initMemberService.init();
}
```

- `init()` ë©”ì„œë“œì—ì„œ íŒ€ê³¼ íšŒì› ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ ì‚½ì…í•˜ëŠ” ë¡œì§ì„ ì‘ì„±í•˜ë©´ ë˜ì§€ ì•Šì„ê¹Œ? ë¼ê³  ìƒê°í•  ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ë‚˜ ê·¸ë ‡ê²Œ í•˜ì§€ ëª»í•œë‹¤.
  - ğŸ‘‰`@PostConstruct`ì™€ `@Transactional`ì„ í•œ ë©”ì„œë“œì—ì„œ ë™ì‹œì— ì‚¬ìš©í•˜ì§€ ëª»í•˜ê¸° ë•Œë¬¸ì´ë‹¤.
  - ë”°ë¼ì„œ, `@PostConstruct`ì„ ì‚¬ìš©í•˜ëŠ” ë©”ì„œë“œì—ì„œ `@Transactional`ì„ ì‚¬ìš©í•˜ëŠ” ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•œë‹¤.
  
<br>

## ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬í˜„

```java
package inf.querydsl.controller;

@RestController
@RequiredArgsConstructor
public class MemberController {

	private final MemberJpaRepository memberJpaRepository;

	@GetMapping("/v1/members")
	public List<MemberTeamDto> searchMemberV1(MemberSearchCondition condition) {
		return memberJpaRepository.search(condition);
	}

}
```

- Repository ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ ê°ì²´ì™€ APIë¥¼ êµ¬í˜„í•œë‹¤.
- `searchMemberV1` íŒŒë¼ë¯¸í„°ì—ì„œ `@ModelAttribute`ëŠ” ìƒëµ ë˜ì—ˆë‹¤.
- í•´ë‹¹ ë¡œì§ì€ ì•„ë˜ì²˜ëŸ¼ WHERE ë‹¤ì¤‘ íŒŒë¼ë¯¸í„°ë¡œ êµ¬í˜„ëœ Querydsl ì„ ì´ìš©í•œë‹¤.

```java
package inf.querydsl.repository;

public List<MemberTeamDto> search(MemberSearchCondition condition) {
    return queryFactory
            .select(new QMemberTeamDto(
                    member.id.as("memberId"),
                    member.username,
                    member.age,
                    team.id.as("teamId"),
                    team.name.as("teamName")))
            .from(member)
            .leftJoin(member.team, team)
            .where(
                    usernameEq(condition.getUsername()),
                    teamNameEq(condition.getTeamName()),
                    ageGoe(condition.getAgeGoe()),
                    ageLoe(condition.getAgeLoe())
            )
            .fetch();
}
```

<br>

### @ModelAttribute ì— ëŒ€í•˜ì—¬

- `@ModelAttribute`ë¥¼ ì‚¬ìš©í•˜ì—¬ Query String -> Object ë§¤í•‘ì´ ê°€ëŠ¥í•˜ë‹¤.
- ìŠ¤í”„ë§ MVCëŠ” `@ModelAttribute`ê°€ ìˆìœ¼ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë™ì‘í•œë‹¤.
  - ì§€ì •í•œ í´ë˜ìŠ¤ íƒ€ì…ì˜ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤. (ìœ„ ê²½ìš°ì—ëŠ” `MemberSearchCondition`)
  - ìš”ì²­ íŒŒë¼ë¯¸í„°ì˜ ì´ë¦„ìœ¼ë¡œ ê°ì²´ì˜ í”„ë¡œí¼í‹°ë¥¼ ì°¾ëŠ”ë‹¤. 
  - ê·¸ë¦¬ê³  í•´ë‹¹ í”„ë¡œí¼í‹°ì˜ setterë¥¼ í˜¸ì¶œí•´ì„œ íŒŒë¼ë¯¸í„°ì˜ ê°’ì„ ë°”ì¸ë”©í•œë‹¤.
  - setter ê°€ ì—†ë‹¤ë©´ ? 
    - ğŸ‘‰ Object ë¡œ ë§¤í•‘ë˜ì§€ ì•ŠëŠ”ë‹¤. 
    - ì¦‰, Object ì˜ í•„ë“œê°€ ëª¨ë‘ null ì´ ëœë‹¤!
- `@ModelAttribute`ëŠ” ìƒëµí•  ìˆ˜ ìˆë‹¤.
  - ê·¸ëŸ°ë° `@RequestParam` ì—­ì‹œ ìƒëµí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, í˜¼ë€ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤. 
  - ìŠ¤í”„ë§ì€ ìœ„ ì–´ë…¸í…Œì´ì…˜ë“¤ì„ ìƒëµ ì‹œ ë‹¤ìŒê³¼ ê°™ì€ ê·œì¹™ì„ ì ìš©í•œë‹¤.
    - String, int, Integer ê°™ì€ ë‹¨ìˆœ íƒ€ì… -> `@RequestParam`
    - ë‚˜ë¨¸ì§€ -> `@ModelAttribute` (argument resolver ë¡œ ì§€ì •í•´ë‘” íƒ€ì… ì™¸)

<br>

## API ì‚¬ìš©

```http request
http://localhost:8080/v1/members?teamName=teamB&ageGoe=31&ageLoe=40
```

- ì…ë ¥í•˜ì§€ ì•Šì€ í•„ë“œëŠ” NULL ìƒíƒœì´ê³ , ì…ë ¥í•œ ì¡°ê±´ ëŒ€ë¡œ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
