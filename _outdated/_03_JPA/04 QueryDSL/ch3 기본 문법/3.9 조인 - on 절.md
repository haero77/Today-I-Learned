# ì¡°ì¸ - ON ì ˆ

- ON ì ˆ
  - í•„í„°ë§ í•˜ëŠ” ê²ƒ
  - ì¡°ì¸í•  ëŒ€ìƒì„ ì¤„ì´ëŠ” ê²ƒ

## 1. ì¡°ì¸ ëŒ€ìƒ í•„í„°ë§

```java
/**
* ì˜ˆ) íšŒì›ê³¼ íŒ€ì„ ì¡°ì¸í•˜ë©´ì„œ, íŒ€ ì´ë¦„ì´ teamAì¸ íŒ€ë§Œ ì¡°ì¸, íšŒì›ì€ ëª¨ë‘ ì¡°íšŒ
* JPQL: select m, t from Member m left join m.team t on t.name = 'teamA'
*/
@Test
@DisplayName("ì¡°ì¸ - ON ì ˆ")
void join_on_filtering() {
    List<Tuple> result = queryFactory
            .select(member, team)
            .from(member)
            .leftJoin(member.team, team).on(team.name.eq("teamA"))
            .fetch();

    for (Tuple tuple : result) {
        System.out.println("tuple = " + tuple);
    }
    /*
        tuple = [Member(id=3, username=member1, age=10), Team(id=1, name=teamA)]
        tuple = [Member(id=4, username=member2, age=20), Team(id=1, name=teamA)]
        tuple = [Member(id=5, username=member3, age=30), null]
        tuple = [Member(id=6, username=member4, age=40), null]
     */
}
```
```sql
/* select
    member1,
    team 
from
    Member member1   
left join
    member1.team as team with team.name = ?1 */ 
select
    member0_.member_id as member_i1_1_0_,
    team1_.team_id as team_id1_2_1_,
    member0_.age as age2_1_0_,
    member0_.team_id as team_id4_1_0_,
    member0_.username as username3_1_0_,
    team1_.name as name2_2_1_ 
from
    member member0_ 
left outer join
    team team1_ 
        on member0_.team_id=team1_.team_id 
        and (
            team1_.name=?
        )
```


> ğŸ’¡ ì°¸ê³ 
> - on ì ˆì„ í™œìš©í•´ ì¡°ì¸ ëŒ€ìƒì„ í•„í„°ë§ í•  ë•Œ, ì™¸ë¶€ ì¡°ì¸ì´ ì•„ë‹ˆë¼ ë‚´ë¶€ ì¡°ì¸(inner join)ì„ ì‚¬ìš©í•˜ë©´, whereì ˆì—ì„œ í•„í„°ë§ í•˜ëŠ” ê²ƒê³¼ ê¸°ëŠ¥ì´ ë™ì¼í•˜ë‹¤.
> - ë”°ë¼ì„œ on ì ˆì„ í™œìš©í•œ ì¡°ì¸ ëŒ€ìƒ í•„í„°ë§ì„ ì‚¬ìš©í•  ë•Œ, ë‚´ë¶€ì¡°ì¸ì´ë©´ ìµìˆ™í•œ where ì ˆë¡œ í•´ê²°í•˜ê³ , ì •ë§ ì™¸ë¶€ì¡°ì¸ì´ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ì.

<br>

### INNER JOIN ì—ì„œì˜ WHEREê³¼ ON

```java
// WHERE
List<Tuple> result = queryFactory
        .select(member, team)
        .from(member)
        .join(member.team, team)
        .where(team.name.eq("teamA"))
        .fetch();
```
```sql
/* select
    member1,
    team 
from
    Member member1   
inner join
    member1.team as team 
where
    team.name = ?1 */ 
select
    member0_.member_id as member_i1_1_0_,
    team1_.team_id as team_id1_2_1_,
    member0_.age as age2_1_0_,
    member0_.team_id as team_id4_1_0_,
    member0_.username as username3_1_0_,
    team1_.name as name2_2_1_ 
from
    member member0_ 
inner join
    team team1_ 
        on member0_.team_id=team1_.team_id 
where
    team1_.name=?
```

```java
// ON
List<Tuple> result = queryFactory
    .select(member, team)
    .from(member)
    .join(member.team, team).on(team.name.eq("teamA"))
    .fetch();
```
```sql
/* select
    member1,
    team 
from
    Member member1   
inner join
    member1.team as team with team.name = ?1 */ 
select
    member0_.member_id as member_i1_1_0_,
    team1_.team_id as team_id1_2_1_,
    member0_.age as age2_1_0_,
    member0_.team_id as team_id4_1_0_,
    member0_.username as username3_1_0_,
    team1_.name as name2_2_1_ 
from
    member member0_ 
inner join
    team team1_ 
        on member0_.team_id=team1_.team_id 
        and (
            team1_.name=?
        )
```

- left outer join ì¸ ê²½ìš°ëŠ” on ì ˆì´ ì˜ë¯¸ê°€ ìˆë‹¤.
- inner join ì¸ ê²½ìš° where ì ˆì„ ì‚¬ìš©í•˜ë‚˜, on ì ˆì„ ì‚¬ìš©í•˜ë‚˜ ê²°ê³¼ê°€ ë˜‘ê°™ë‹¤.
  - ì´ëŸ° ì¼€ì´ìŠ¤ì—ì„œëŠ” ê·¸ëƒ¥ where ì ˆì„ ì“´ë‹¤.
  - where ì ˆì—ì„œ ì‚¬ìš©í•˜ëŠ”ê²Œ ë³´ê¸°ì— ë” ê¹”ë”

<br>

## 2. ì—°ê´€ê´€ê³„ ì—†ëŠ” ì—”í‹°í‹° ì™¸ë¶€ ì¡°ì¸

```java
/**
 * ì—°ê´€ê´€ê³„ ì—†ëŠ” ì—”í‹°í‹° ì™¸ë¶€ ì¡°ì¸
 * íšŒì›ì˜ ì´ë¦„ì´ íŒ€ ì´ë¦„ê³¼ ê°™ì€ ëŒ€ìƒ ì™¸ë¶€ ì¡°ì¸
 */
@Test
@DisplayName("ì—°ê´€ê´€ê³„ ì—†ëŠ” ì—”í‹°í‹° ì™¸ë¶€ ì¡°ì¸")
void join_on_no_relation() {
    em.persist(new Member("teamA"));
    em.persist(new Member("teamB"));
    em.persist(new Member("teamC"));

    List<Tuple> result = queryFactory
            .select(member, team)
            .from(member)
            .leftJoin(team).on(member.username.eq(team.name))
            .fetch();

    for (Tuple tuple : result) {
        System.out.println("tuple = " + tuple);
    }
}
```

```sql
/* select
    member1,
    team 
from
    Member member1   
left join
    Team team with member1.username = team.name */ 
select
    member0_.member_id as member_i1_1_0_,
    team1_.team_id as team_id1_2_1_,
    member0_.age as age2_1_0_,
    member0_.team_id as team_id4_1_0_,
    member0_.username as username3_1_0_,
    team1_.name as name2_2_1_ 
from
    member member0_ 
left outer join
    team team1_ 
        on (
            member0_.username=team1_.name
        )
```

```text
tuple = [Member(id=3, username=member1, age=10), null]
tuple = [Member(id=4, username=member2, age=20), null]
tuple = [Member(id=5, username=member3, age=30), null]
tuple = [Member(id=6, username=member4, age=40), null]
tuple = [Member(id=7, username=teamA, age=0), Team(id=1, name=teamA)]
tuple = [Member(id=8, username=teamB, age=0), Team(id=2, name=teamB)]
tuple = [Member(id=9, username=teamC, age=0), null]
```

- í•˜ì´ë²„ë„¤ì´íŠ¸ 5.1ë¶€í„° on ì ˆì„ ì‚¬ìš©í•´ì„œ ì„œë¡œ ê´€ê³„ê°€ ì—†ëŠ” í•„ë“œë¡œ ì™¸ë¶€ì¡°ì¸ í•˜ëŠ” ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì—ˆë‹¤. ë¬¼ë¡  ë‚´ë¶€ì¡°ì¸ë„ ê°€ëŠ¥í•˜ë‹¤.
- ì˜¤ë¥¸ìª½ í…Œì´ë¸”ì—ì„œ íŒ€ ì´ë¦„ê³¼ íšŒì› ì´ë¦„ì´ ê°™ì€ ì¼ë¶€ë¶„ë§Œ ê°€ì ¸ì™€ì„œ ì¡°ì¸ì„ í•œë‹¤.
- ì£¼ì˜! ë¬¸ë²•ì„ ì˜ ë´ì•¼í•œë‹¤. `leftJoin()` ë¶€ë¶„ì— ì¼ë°˜ì¡°ì¸ê³¼ ë‹¤ë¥´ê²Œ ì—”í‹°í‹° í•˜ë‚˜ë§Œ ë“¤ì–´ê°„ë‹¤. 
  - ì¼ë°˜ ì¡°ì¸: `leftJoin(member.team, team)`
  - on ì¡°ì¸: `from(member).leftJoin(team).on(xxx)`