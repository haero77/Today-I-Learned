# í”„ë¡œì ì…˜ê³¼ ê²°ê³¼ ë°˜í™˜ - DTO ì¡°íšŒ

## ìˆœìˆ˜ JPAì—ì„œ DTO ì¡°íšŒ

- ìˆœìˆ˜ JPAì—ì„œ JPQLì„ ì´ìš©í•œ DTO ì¡°íšŒ ì‹œì—ëŠ” new ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì•¼í•¨.
- DTOì˜ package ì´ë¦„ì„ ë‹¤ ì ì–´ì¤˜ì•¼í•˜ë¯€ë¡œ ì§€ì €ë¶„í•¨.
- ìƒì„±ì ë°©ì‹ë§Œ ì§€ì›í•œë‹¤.

ğŸ‘‰ Querydslì€ ìœ„ ê°™ì€ ë¬¸ì œì ë“¤ì„ í•´ê²°í•œë‹¤.


## Querydsl ë¹ˆ ìƒì„±(Bean population)

- ê²°ê³¼ë¥¼ DTOë¡œ ë°˜í™˜í•  ë•Œ ì‚¬ìš©í•œë‹¤.
- ë‹¤ìŒ 3ê°€ì§€ ë°©ë²• ì§€ì›
  - í”„ë¡œí¼í‹° ì ‘ê·¼(Bena Property. Getter & Setter)
  - í•„ë“œ ì§ì ‘ ì ‘ê·¼
  - ìƒì„±ì ì‚¬ìš©

### í”„ë¡œí¼í‹° ì ‘ê·¼ - Setter

```java
@Test
@DisplayName("Querydsl DTO ì¡°íšŒ - Setter")
void findDtoBySetter() {
    List<MemberDto> result = queryFactory
            .select(Projections.bean(MemberDto.class,
                    member.username,
                    member.age))
            .from(member)
            .fetch();

    for (MemberDto memberDto : result) {
        System.out.println("memberDto = " + memberDto);
    }
}
```

![image](https://github.com/haero77/Today-I-Learned/assets/65555299/ebc9a272-3c02-4298-8e6a-61d9f751c85d)

- `NoSuchMethodException`
  - ê¸°ë³¸ ìƒì„±ìê°€ ì—†ì–´ì„œ ë°œìƒí•œ ì˜¤ë¥˜ 
  - Querydslì´ ê°ì²´ ë§Œë“ ë‹¤ìŒì— Set í•´ì•¼í•˜ëŠ”ë° ê¸°ë³¸ ìƒì„±ìê°€ ì—†ì–´ì„œ ì—ëŸ¬ê°€ ë°œìƒ



### í•„ë“œ ì§ì ‘ ì ‘ê·¼

```java
@Test
@DisplayName("Querydsl DTO ì¡°íšŒ - Field ")
void findDtoByField() {
    List<MemberDto> result = queryFactory
            .select(Projections.fields(MemberDto.class,
                    member.username,
                    member.age))
            .from(member)
            .fetch();

    for (MemberDto memberDto : result) {
        System.out.println("memberDto = " + memberDto);
    }
}
```

- Getter, Setter ê°€ ì—†ì–´ë„ ëœë‹¤.

### ìƒì„±ì ì‚¬ìš©

```java
@Test
@DisplayName("Querydsl DTO ì¡°íšŒ - ìƒì„±ì ")
void findDtoByConstructor() {
    List<MemberDto> result = queryFactory
            .select(Projections.constructor(MemberDto.class,
                    member.username,
                    member.age))
            .from(member)
            .fetch();

    for (MemberDto memberDto : result) {
        System.out.println("memberDto = " + memberDto);
    }
}
```

## ë³„ì¹­ì´ ë‹¤ë¥¼ ë•ŒëŠ” as ì‚¬

```java
@ToString
public class UserDto {

	private String name;
	private int age;

	public UserDto() {
	}

	public UserDto(String name, int age) {
		this.name = name;
		this.age = age;
	}

}
```

```java
@Test
@DisplayName("í•„ë“œì´ë¦„ì´ ë§ì§€ ì•ŠëŠ” ê²½ìš° as ì‚¬ìš©")
	void findUserDto() {
		QMember memberSub = new QMember("memberSub");

		List<UserDto> result = queryFactory
                          .select(Projections.fields(UserDto.class,
	                        member.username.as("name"),
	                        ExpressionUtils.as(JPAExpressions
	                            .select(memberSub.age.max())
	                            .from(memberSub), "age")
	                        ))
                          .from(member)
                          .fetch();
}
```
- í”„ë¡œì ì…˜ ì»¬ëŸ¼ì´ë¦„ì€ `username` ì¸ë°, UserDtoì˜ í•„ë“œëª…ì€ `name`ì´ë‹¤.
- ê·¸ëƒ¥ ì¡°íšŒì‹œ nullë¡œ ë§¤í•‘ë˜ë¯€ë¡œ, ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ `as()`ë¥¼ ì‚¬ìš©í•œë‹¤.
- ì„œë¸Œì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” `ExpressionUtils.as()`ë¥¼ ì‚¬ìš©í•˜ì—¬ aliasë¥¼ ì¤€ë‹¤.

