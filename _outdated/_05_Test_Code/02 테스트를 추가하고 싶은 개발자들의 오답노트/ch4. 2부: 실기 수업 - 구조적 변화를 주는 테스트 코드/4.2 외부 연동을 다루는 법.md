# ì™¸ë¶€ ì—°ë™ì„ ë‹¤ë£¨ëŠ” ë²•

- Repository ë‚˜ JavaMailSender ë“± ì™¸ë¶€ ì—°ë™ì— ì˜ì¡´ì„± ì—­ì „ì„ ì‚¬ìš©í•´ë³´ì

<br>

### í™•ì‹¤í•œ ë„¤ì´ë°

- ê¸°ì¡´ì— ìˆëŠ” Repository ë“¤ì˜ ì´ë¦„ì„ ëª…í™•í•˜ê²Œ JpaRepositoryë¡œ ë³€ê²½í•œë‹¤.

![img.png](img/4.2/img.png)

<br>

## ì˜ì¡´ì„± ì—­ì „ì„ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤ ë§Œë“¤ê¸°

![img_1.png](img/4.2/img_1.png)

- RepositoryImpl ì€ Repository ë¥¼ êµ¬í˜„í•˜ê³ , JpaRepository ëŠ” ì˜ì¡´ì„±ì„ ì£¼ì…ë°›ì•„ ì‚¬ìš©í•œë‹¤.

<br>

### Repositoryê°€ infrastucture ì— ìˆì–´ë„ ë˜ë‚˜?

![img_2.png](img/4.2/img_2.png)

- UserRepositoryë¥¼ infrastructure ì— ë‘ë©´, ìƒìœ„ ëª¨ë“ˆì¸ service ì—ì„œ infrastructure ì¸ íŒ¨í‚¤ì§€ì— ì˜ì¡´í•˜ê²Œ ë˜ëŠ”ë°, ê·¸ëŸ¼ ì•ˆ ëœë‹¤.
- UserRepositoryë¥¼ service íŒ¨í‚¤ì§€ì— ë‘ê³ , **_service ìª½ì— ì™¸ë¶€ ì—°ë™ì„ ë‹´ë‹¹í•˜ëŠ” port íŒ¨í‚¤ì§€_** ë¥¼ ë§Œë“¤ì.

![img_3.png](img/4.2/img_3.png)

- port íŒ¨í‚¤ì§€ëŠ” ì™¸ë¶€ ì—°ë™ì„ ë‹´ë‹¹í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ìœ„ì¹˜ì‹œí‚¨ë‹¤.
  - ì´ì œ service ëŠ” ë” ì´ìƒ infrastructure ë¥¼ ì°¸ì¡°í•˜ì§€ ì•Šê³ , port ë§Œ ì˜ì¡´í•˜ê²Œ ëœë‹¤. 

### Repository ì˜ì¡´ì„± ì—­ì „

![img_4.png](img/4.2/img_4.png)

<br>

### MailSender ì˜ì¡´ì„± ì—­ì „

![img_6.png](img/4.2/img_6.png)

- CertificationService ë¥¼ ë§Œë“¤ì–´ ë©”ì¼ì„ ì „ì†¡í•˜ëŠ” ì±…ì„ì„ ìœ„ì„í•œë‹¤.
- **_Service ê°€ ë§Œë“¤ì–´ì¡Œìœ¼ë‹ˆ, í…ŒìŠ¤íŠ¸ë„ ë§Œë“¤ì–´ë³´ì_**

![img_7.png](img/4.2/img_7.png)

- MailSenderë¥¼ êµ¬í˜„í•˜ëŠ” FakeMailSender ë¥¼ mock íŒ¨í‚¤ì§€ í•˜ìœ„ì— ë§Œë“ ë‹¤.

```java
class CertificationServiceTest {

    @DisplayName("ì´ë©”ì¼ê³¼ ì»¨í…ì¸ ê°€ ì œëŒ€ë¡œ ë§Œë“¤ì–´ì ¸ì„œ ë³´ë‚´ì§€ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•œë‹¤.")
    @Test
    void send() {
        // given
        FakeMailSender fakeMailSender = new FakeMailSender();
        CertificationService certificationService = new CertificationService(fakeMailSender);

        // when
        certificationService.send("kok202@naver.com", 1, "aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaab");

        // then
        assertThat(fakeMailSender.email).isEqualTo("kok202@naver.com");
        assertThat(fakeMailSender.title).isEqualTo("Please certify your email address");
        assertThat(fakeMailSender.content).isEqualTo("Please click the following link to certify your email address: http://localhost:8080/api/users/1/verify?certificationCode=aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaab");
    }

}
```

- CertificationService ëŠ” MailSender ì˜ì¡´ì„±ì„ í•„ìš”ë¡œ í•œë‹¤. êµ¬í˜„ì²´ë¡œ FakeMailSender ë¥¼ ìƒì„±ìì—ì„œ ì£¼ì…í•´ì¤€ë‹¤.
- í…ŒìŠ¤íŠ¸ë„ ë¹ ë¥´ê³  ì‰½ë‹¤.

<br>


### ğŸ¤” ì—¬ê¸°ì„œ ë“œëŠ” ì˜ë¬¸ 

- ê·¸ëŸ¼ ì‹¤ì œë¡œ ë©”ì¼ì´ ì˜ ì „ì†¡ë˜ì—ˆëŠ”ì§€ëŠ” ì–´ë–»ê²Œ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ë³´ì¥í•˜ì§€?
  - ë³´ì¥ ë¶ˆê°€ëŠ¥í•œ ì˜ì—­ì¸ê°€?
  - í…ŒìŠ¤íŠ¸ê°€ í”„ë¡œë•ì…˜ì„ ì™„ì „íˆ ì»¤ë²„í•  ìˆ˜ëŠ” ì—†ëŠ”ê±´ê°€?